\ advanced discord bot
\ discord.sc specimen

spec code { ver = 5.3 | syn = utinax | sty = stan }


enable sys

locate, activate discord
activate slash in discord

activate securex


create discord.bot(demo) [ key = securex.redact("token") | intents = all ] {
  let bot.commands.prefix = "."
}

on demo.connect {{
  sys.out("connected")
}}

create discord.command {
  define bot.test(ctx) {
    await ctx.out("sup")
  }
}

create discord.command 'x2' {
  define bot.x2(ctx, number) {
    await ctx.reply(number * 2)
  }
}

create discord.slash.command [desc = "help and info"] {
  define bot.help(ctx) {
    await ctx.respond() [embed = discord.embed() {
      let head.title = "Help"
      let main.colour = 0x4090f1
      let main.text = """
        A demonstrative advanced Discord bot, showcasing all of the capabilities of discord.sc
      """
      let foot.text = "Requested by `ctx.message.sender`",
    }]
  }
}

create discord.slash.command [desc = "get profile picture of a user in the server"] {
  define bot.pfp(ctx, discord.member(user)) {
    await ctx.respond() [attach = sys.file(user.avatar.url), ephemeral = true]
  }
}

create discord.slash.command [desc = ""] {
  define bot.func(ctx, discord.option(choice)[...]) {
    ...
  }
}

on discord.message.send(ctx) {{
  sys.log(ctx.message.content)
  await demo.process(ctx)
}}

on discord.interaction(ctx) {
  sys.log(interaction.data)
  await demo.slash.process(ctx)
}


demo.start()
